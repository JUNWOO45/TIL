# NHN





## NHN Family Talk

nhn이 이러케 성장하고 있읍니다..



## 초청특강 Recommendation Systems : Concepts, Techniques, and Research Results

- 무슨말이지.. 어렵다....
- "Uninteresting items란 개념은 참으로 intersting하다..!"



## 점진적으로 프론트엔드 프레임워크 교체하기(AngularJS to Vue) - 유동식

### 1. 프레임워크 교체

#### 왜 바꿔요?

- 지원이 중단. 
  - 신규 기능 개발 어려워.
  - 커뮤니티에서도 서드파티 패키지 지원 중단

- 개선된 상태관리, 라우팅, 컴포넌트 기반 구조등 새로운 기능 사용할 수 없음.
- 성능이 느려지고 유연성, 확장성이 떨어짐
- 커리어에 도움이 되지않고 개발자 채용도 점점 어려워짐

#### 최신 프레임워크의 장점 수용

- 잘 관리됨, 안정성 높은 리액트, 뷰
- 코드 가독성과 컴포넌트 재사용성 증가
- 성ㅇ(라이브러리 크기, 메모리, 속도) 향상
- cli, storybook
- Single File component
- webpack을 통한 비동기 로딩 지원도 굳.

### 2. 왜 점진적인가?

#### 전면 교체는 리스크가 크다.

- 처음부터 다시 구현해야하며 디자인, 기능을 똑같이 구현해야한다.
- 시간이 오래걸리고 비용이 크다.
- 몇 년이 걸린다.
- 조금씩 바꾸어 나간다면 해볼만하지않을까?

#### 컴포넌트 단위로 분해하고 하나씩 정복

- 리스크를 줄이고 빠른 적용 및 배포
- 마이크로 프런트엔드
  - 웹페이지 내에서 영역을 구분, 독립적으로 개발, 그리고 합치는 개념.
  - 스샷.

#### 장점

- 리스크가 낮고 결과물을 빠르게 확인할 수 있다.

### 3. 교체 전 필수 준비 사항

#### 사전 기능 파악 철저

- 잘 정리된 문서와 꼼꼼한 기능 파악은 서비스의 안정성을 올린다.

- 필수 : 기획서확보, QA시트 확보, 설계문서, 기능파악

  - 서비스 기획서 확보

    - 모든 기능의 망라
    - 빠진 기능 하나도 없이.

  - QA 테스트 케이스 문서 확보

  - 코드를 통한 기능 파악

    - 문서를 통해서는 드러나지않는 부분.
    - ex) bootstrap -> material ui

    

### 4. 점진적으로 프레임워크 교체하기

#### 웹 페이지 구조 결정 과정

> 어떻게 한 페이지 내에서 두 프레임워크를 잘 돌릴까?

#### SPA포기, 별도 페이지 분리

장점 :

- 기존 구현과 명확히 분리
- js, css가 영향 주고받지 않음.
- webpack으로 페이지별로 사용되는 파일만 정확하게 번들 가능

단점 :

- spa 장점 사라짐
- 서비스 탭 클릭 시 페이지 깜빡
- 리소스를 새로 로딩해야하므로 spa대비 로딩 성능 저하



#### spa유지, iframe 사용

장점

- 기존 구현과 명확히 분리
- Js, css가 영향 주고 받지 않음.
- webpack으로 사용되는 파일만 정확하게 번들 가능

단점

- 리소스를 새로 로딩해야하므로 로딩 성능 저하
- 프레임 깜빡임현상 여전
- xss 보안에 더 취약
- 프레임 간 통신 방법에 제약(postMEssage)
- iframe내부 라우터를 모두 부모에서 처리해야한다.



#### angularjs 컴포넌트 내부에서 vue컴포넌트 

장점

- spa 유지, 깜빡임 없음
- 특ㅓㅇ 영역만 vue로 전환 용이. 멀티인스턴스 기능
- iframe 대비 가볍고 빠름



단점

- 라우터 관리는 angularJS에서만 하도록 처리 필요.
- js, css 용량이 늘어날 수 잇음(프레임워크 2개니깐.)
- css 충돌이 날 가능성이 큼(비슷한 이름으 ㅣ선택자를 사용할 가능성)

---

#### vue 다이나믹 컴포넌트를 사용하여 서비스별로 컴포넌트를 다르게 사용.

#### 비동기 컴포넌트 사용으로 필요할 때만 js 다운로드하게 한다.



#### 두 프레임워크 간 통신하는 방법(데이터를 주고 받는 방법)

1. vue의 리액티브 시스템 활용

- 리액티븟 시스템을 활용하여 라우터 데이터를 vue에게 계속 전달한다.
  - 관ㅅ미있는 라우터 상태가 변경되면 props 데이터를 변경한다.

1. Vuex dispatch, commit 사용

1. event를 사용해서 앵귤러에서 event를 수신.

---

#### storybook 꼭 사용하세요.

---

### 5. 성능비교

#### 회기테스트

사전 성능 파악이 중요한게 여기서 드러남.



#### 용량

- Vue 와 element-ui를 추가했음에도 리소스 용량이 큰 변화가 없다.

#### 로딩성능 테스트

- DCL(domcontentloaded) : html용량은 변화가 없어서 변화x
- L(load):소폭하락.
- FMP(first meaningful paint): 2초나 빨라짐
  - 왜?
  - 개발자도구에서 퍼포먼스 비교.
  - ui-grid 라이브러리의 비동기 로딩 및 초기화가 제거되어서 줄어든듯.

---

### 마무리

> 꼭 사전 기능 파악 꼭.하세요...꼭..!





## 2번째 세션 실용적인 프론트엔드 테스트 전략

서문.

#### 항상 머릿속에 맴도는 질문

내가 작성하는 테스트가 나에게 도움을 주고 있는걸까 정말?

프ㄴ트엔드 테스트는 대체 무엇을 어떻게 테스트해야하는 걸까?

#### 답을 찾기 위한 fe개발랩의 끊임없는 노력

자스민, 카르마, 세렐니옴 웻드라이버, 제스트, 테스트카페, Cypress, Storybook, Applitools 등등.



목차.

### 프론트엔드 테스팅 이해하기

- 테트 코드 작성하는 이유
- 프론트엔드 테스트가 어려운이유 : 시각적 요소 검증

### 시각적 테스트 vs 기능적 테스트

- storybook

### 단위테스트 vs 통합테스트

- cypress

---

### 개발자가 왜 테스트를 작성해야 할까요?

- Confidence.
  - 자신감.신뢰.
  - 내가 그걸 믿고 리팩토링하고, 품질개선하고, 배포하고, 야근안하고..!

### 근본적ㅇ니 어려움.

- 입력.
  - DOM 이벤트
  - ...

- 출력
  - 시각적 요소가 많아서 검증이 까다로움.

### 시각적 요소의 검증

1. html비교
2. 제스트의 스냅숏 테스트.
   1. .toMatchSnapshot();



### html비교의 문제점

#### 1.테스트가 나에게 신뢰를 주는가?

- html만보고 구조를 파악할 수 있을까? 
  - ㄴㄴ css가 필요함
- html/css가 리팩토링할때 도움을 주는가?
  - ㄴㄴ...



#### 2.구현 상세 테스트 vs 동작 테스트

- 구현 상세에 대한 테스트 지양 & 동작을 테스트하라.



### 3.이미지 비교

- 시각적 회귀 테스트(Visual Regression Testing).
  - 의도한 변화는 스크린샷 갱신시킴.
  - 하지만 여전히 어려움이 있음.
    - 캡쳐 이미지의 신뢰성
      - 픽셀 단위 비교: 의미있는 변경을 찾기 어려움.
      - 운영체ㅔㅈ, 브라우저 등의 렌더링 방식 차이.
      - 이미지/폰트 로딩 시간, 커서, 애니메이션 등으로 인한 캡쳐 시점 차이.
    - 결과 확인 및 이력 관리
      - 커맨드라인에서 확인 불가능 -> 결과 확인을 위한 ui vlfdy
      - 브라우저, 뷰포트 크기 등의 케이스별 이미지 파일 생성 및 관리.
      - 테스트 실행 단위별 이미지 파일 히스토리 관리
  - 시각적 테스트 전문 도구
    - applitools, percy, chromatic 등이 유명.
    - 단점 : 유료..
- 근데 시각적 테스트는 여전히 문제가 많음..
  - 첫번째 문제는 속도.
    - 스ㅣㄴ샷을 생성할 수 있는 환경(selenium, puppeteer 등)에서만 테스트 가능
  - 두번째는 테스트의 큰 역할 중하나가 스펙 문서화.
    - 근데 스크린샷은 그런 기능을 하지 못함.
    - tdd불가능. -> 회귀 테스트 용도로만 사용.



### 기능적인 테스트와, 시각적인 테스트를 적절하게 섞어서 테스트를 해야한다.

두개 모두 잘 섞는게 중요함.

서로가 서로를 보완.



#### 기능적 테스트 : 시각적 요소 의존성 제거.

- 시각적 테스트를 수정하려고 class명을 수정했을때 기능적테스트까지 깨지는 경우를 방지해야한다.



### 시각적 테스트 : 케이스 검증

- ex) 1자리수 + font-size: 5em / 2자리 수 + font-size: 4em 등 / 3자리 수 + font-size: 3em 등.



### Storybook : UI 컴포넌트 개발 환경

#### - 독립된 컴포넌트 개발 환경

#### - 컴포넌트의 다양한 상태를 등록/관리



### 가장 중요한 것은 밸런스

#### 시각적 테스트 vs 기능적 테스트

- 둘 사이의 구분이 명확하지 않은 경우도 많음.
- 프로젝트, 컴포넌트, 기능별 특징에 따라 적절한 방식 선택
- 테스트의 가치와 비용을 고려한 균형있는 선택 필요

#### 단위테스트 vs 통합테스트

- 각각의 장단점이 있음
- 컴포넌트 단위의 통핣 테스트를 우선적으로 고려.



### 요약

스샷.

#### 



## 레거시 웹 서비스 길들이기 : 서버개발자의 SPA 적용기

내가 마주한 레거시: MVC 패턴의 일체형 웹 서비스.

- 링크를 클릭해도.. 데이터를 변경해도... 항상 새로고침이 일어남..
- 점점 비대해지는 웹 서비스
  - 코드에 체계와규칙이 없다.
  - 잘 짜고있는건지 서로 모른다.
  - 코드가 더러워진다.
  - 만지기 싫어진다..
  - 리뷰를 해도 이게맞나? 저게맞나? 팀월들이 서로 모름..



#### API 호출 방식

- 일체형 웹 서비스에서는?

  - 서버 렌더링을 위해 api 명세에맞는 VO클래스를 모두 구현.

- 클라이언트 렌더링에서도 이렇게 해야될까?

  - 더이상 서버에서 렌더링을 하지 않는데 VO클래스를 만들어야하나? 프록시역할만 하는데..

  - 요즘 유행하는게 있더라구요. 
  - API Gateway.
    - 불필요한 중복 코드를 걷어내자.



#### 상태 관리

- 복잡한 컴포넌트 간 데이터 전달
  - 상태 관리 라이브러리를 쓰면 됩니다. 
  - ex) Vuex, Redux...



- Vuex 사용 팁
  - API 호출 횟수를 줄여보기
    - lodash의 debounce.
    - 이미 로드한 데이터라면 추가로 호출하지 않도록 처리.
  - 데이터 가공은 어떻게?
    - RxJS에는 데이터 가공을 위한 유용한 연산자가 많이 있습니다.
  - vuex의 state, getter는 컴포넌트 뿐 아니라 다른 곳에서도 호출이 가능합니다.
    - router에서 사용하면 데이터 로딩이 완료된 다음에 화면을 노출할 수 있음.
      - 서버렌더링처럼 보이는 효과
  - 결론:
    - 복잡한 ui구성하는 페이지에서는 상태관리 라이브러리를 사용하자.



#### 다국어 처리

- vue-i18n 플러그 인 사용.
- 새고침 없이도 언어 변경 가능.
- 그러나 남아있는 문제점
  - 문ㅜ가 수정될때마다 배포/빌드
    - 우리팀의 해결책 : 메시지 서비스

#### 배포 환경에 따른 설정 값 처리

- development vs production
- 실무에서는?
  - 각 환경에 따라 사용되는 도메인 주소, AppKey등의 환경 변수가 달라져야함.
- webpack 설정 파일의 분리.
  - ex) webpack.dev.js, webpack.alpha.js, webpack.beta.js등.
  - package.json에서 빌드 명령어를 환경별로 추가.
- 결과
  - 개발환경은 개발 편의성 / 운영 환경은 성능 위주로 구성하자.



---

webpack dev server의 hot reloading으로 개발이 엄청 편해짐.

(이거 우리 프로젝트에 써보자.)





#### 



## 한 번 더 듣는 '깃' 깔나는 Git 워크플로 알아보기

